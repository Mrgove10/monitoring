<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Monitoring</title>
    <script src="https://unpkg.com/mqtt@4.0.0/dist/mqtt.min.js"></script>
</head>

<body>
    <h1>Monitoring</h1>
    Machines currently sending data :
    <p id="area"></p>

    <script>
        var client = mqtt.connect('mqtt://test.mosquitto.org:8080')

        client.on('connect', function () {
            client.subscribe('2399ce45-7651-45a6-acaf-f8c5ca71180a', function (err) {
            })
        })

        var machines = []
        var lastvalues = [];

        client.on('message', function (topic, message) {
            data = JSON.parse(message.toString());
            console.log(data)
            if (machines.length === 0 && !machines.includes(data.hostname)) {
                addMachineToList(data.hostname);
            }
            else {
                /*  if (lastvalues.length === 0) {
                      lastvalues.push(data);
                  } else {
                      lastvalues.forEach(lv => {
  
                          if (lv.hostname === data.hostname) {
                              lv = data;
                          } else {
                              lastvalues.push(data);
                          }
  
                      });
                  }*/
            }
            console.log(lastvalues)
            console.log(machines)
        });

        function addMachineToList(hostname) {
            console.log("New machine joined : " + hostname)
            machines.push(hostname);
            document.getElementById("area").innerHTML += hostname + "<br>";
        }

    </script>
</body>

</html>