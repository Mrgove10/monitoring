<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Socket.io</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.15/c3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.14/c3.min.css" />
</head>

<body>
    <h1>Communication with socket.io!</h1>
    Machines currently sending data :
    <p id="area"></p>

    <script>
        var machines = []
        var lastvalues = [];
        var socket = io();
        socket.on('data', function (data) {
            data = JSON.parse(data);
            // console.log(data)
            if (machines.length === 0 && !machines.includes(lv.hostname)) {
                addMachineToList(lv.hostname);
            }
            else {
                if (lastvalues.length === 0) {
                    lastvalues.push(data);
                } else {
                    lastvalues.forEach(lv => {

                        if (lv.hostname === data.hostname) {
                            lv = data;
                        } else {
                            lastvalues.push(data);
                        }

                    });
                }
            }
            console.log(lastvalues)
            console.log(machines)
        });

        function addMachineToList(hostname) {
            console.log("New machine joined : " + hostname)
            machines.push(hostname);
            document.getElementById("area").innerHTML += hostname + "<br>";
        }

    </script>
</body>

</html>